<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>java.lang.IllegalArgumentException:Can not set XXX to com.sun.proxy.$Proxy28</title>
      <link href="/2018/07/10/Can-not-set-XXX-to-com-sun-proxy-Proxy28/"/>
      <content type="html"><![CDATA[<p>最近Spring项目启动报错java.lang.IllegalArgumentException: Can not set XXX to com.sun.proxy.$Proxy28经过检查发现是使用 @Autowired 时，写在了接口的实现类上面，由于spring AOP动态代理是通过接口，如果不做配置的话一般情况使用的是Java原生的动态代理，所以注入地方都要通过接口进行注入，如果通过实现类进行注入就会报这个错<br>代码如下：<br><a id="more"></a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class MonitorService &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private JobFlowService jobFlowService;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Service(&quot;jobFlowService&quot;)</span><br><span class="line">public class JobFlowService implements IScheduleExecutor &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>有两种解决方案</p><ul><li>1.在你的项目spring配置文件中添加一行配置:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;aop:aspectj-autoproxy proxy-target-class=&quot;true&quot;/&gt;</span><br></pre></td></tr></table></figure><p>强制让Spring使用cglib生成代理类，就可以通过接口的实现类上@Service等类似注解进行注入</p><ul><li>2.更改代码，写成用接口注入如下：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class MonitorService &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private JobFlowServiceImpl jobFlowService;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> proxy </tag>
            
            <tag> IllegalArgumentException </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Shadowsocks安卓客户端（下载+配置）</title>
      <link href="/2018/07/09/Shadowsocks%E5%AE%89%E5%8D%93(Android)%E5%AE%A2%E6%88%B7%E7%AB%AF%EF%BC%88%E4%B8%8B%E8%BD%BD%E5%8F%8A%E9%85%8D%E7%BD%AE%EF%BC%89/"/>
      <content type="html"><![CDATA[<h2 id="软件准备"><a href="#软件准备" class="headerlink" title="软件准备"></a>软件准备</h2><p>首先，点击下方按钮下载安卓版的客户端 Shadowsocks 。</p><p>如果您是用微信打开的话，先点击手机右上角的三个点，然后选择手机自带的浏览器打开，这样才能下载成功。</p><p>官方提供了几个不同版本，根据你手机的cpu选择合适的apk安装包（如果你也不知道，那就选择结尾是universal的就好啦）<br><a id="more"></a><br><img src="ss下载页.jpg" alt="github下载页"></p><p><a href="https://github.com/shadowsocks/shadowsocks-android/releases" target="_blank" rel="noopener">点我进入下载页</a></p><h2 id="安装-Shadowsocks"><a href="#安装-Shadowsocks" class="headerlink" title="安装 Shadowsocks"></a>安装 Shadowsocks</h2><p>如果是手机下载的，可以用手机里的文件管理器，找到该 APK 安装；如果是电脑下载的，请导入到手机里进行安装。安装完毕手机桌面会出现一个叫“影梭”的 APP。这个“影梭”就是安卓版 Shadowsocks 的中文名字。</p><p><img src="Android-Shadowsocks.jpeg" alt="Android-Shadowsocks"></p><h2 id="导入配置"><a href="#导入配置" class="headerlink" title="导入配置"></a>导入配置</h2><h3 id="影梭首页和删除默认配置"><a href="#影梭首页和删除默认配置" class="headerlink" title="影梭首页和删除默认配置"></a>影梭首页和删除默认配置</h3><p>打开影梭，你看到的首页是这个样子。它会默认一个配置，这个配置是没有用的，可以左滑或者右滑删除掉。</p><p><img src="ss_android_01-1024x602.jpg" alt="Android-Shadowsocks"></p><h3 id="添加新配置"><a href="#添加新配置" class="headerlink" title="添加新配置"></a>添加新配置</h3><p>点击右上角的加号，选择”手动设置”。</p><ul><li>如果安装了PC端的ss，也可以选择扫描二维码导入，非常方便</li></ul><p><img src="ss_android_02-1024x418.jpg" alt="Android-Shadowsocks"></p><p><img src="ss_android_03-1024x604.jpg" alt="Android-Shadowsocks"></p><h3 id="填写配置"><a href="#填写配置" class="headerlink" title="填写配置"></a>填写配置</h3><p>进入添加配置的设置界面后，按照下图所示，根据服务商给你提供的配置，依次填写。填写完毕后，点击右上角的对号✔️保存。</p><p><img src="ss_android_04-576x1024.jpg" alt="Android-Shadowsocks"></p><h3 id="选中新加配置"><a href="#选中新加配置" class="headerlink" title="选中新加配置"></a>选中新加配置</h3><p>添加完毕返回到软件首页，注意看，首页有了你新添加的配置。注意，配置的最左侧是灰色的，说明未被使用，点击配置，最左侧变为绿色，说明使用该配置（如下图）。同时，如果发现配置填写错误，可以点击右侧的小铅笔再次编辑修改。</p><p><img src="ss_android_05-1024x464.jpg" alt="Android-Shadowsocks"></p><p><img src="ss_android_06-1024x418.jpg" alt="Android-Shadowsocks"></p><h2 id="启动和关闭。"><a href="#启动和关闭。" class="headerlink" title="启动和关闭。"></a>启动和关闭。</h2><p>右下角的小飞机即为开关按钮，如果处于灰色状态，说明是关闭中；可点击打开连接，打开即为绿色。</p><p><img src="ss_android_07-1024x373.jpg" alt="Android-Shadowsocks"></p><p><img src="ss_android_08-1024x384.jpg" alt="Android-Shadowsocks"></p><h2 id="测试是否连接成功"><a href="#测试是否连接成功" class="headerlink" title="测试是否连接成功"></a>测试是否连接成功</h2><p>打开浏览器看看是否能上谷歌了。（强烈建议不要使用国产浏览器，尤其是华为小米自带的浏览器，此处推荐 Chrome，就算用国产的浏览器，推荐使用夸克或Via浏览器）。</p><p>最后，恭喜你，自由了。</p><p><img src="success.jpeg" alt="Android-Shadowsocks"></p>]]></content>
      
      <categories>
          
          <category> 科学上网 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Shadowsocks </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Https升级指南</title>
      <link href="/2018/06/19/https%E5%8D%87%E7%BA%A7%E6%8C%87%E5%8D%97/"/>
      <content type="html"><![CDATA[<h2 id="获取证书"><a href="#获取证书" class="headerlink" title="获取证书"></a>获取证书</h2><p>升级到https的第一步就是要先获取一张证书。<br>证书是一个二进制文件，里面包含经过认证的网站公钥和一些元数据，要从经销商购买。</p><h3 id="证书的概念"><a href="#证书的概念" class="headerlink" title="证书的概念"></a>证书的概念</h3><ul><li>证书的概念：首先要有一个根证书，然后用根证书来签发服务器证书和客户证书。服务器证书和客户证书是平级关系。SSL必须安装 服务器证书来认证。 因此，在此环境中，至少必须有三个证书：根证书，服务器证书，客户端证书。 在生成证书之前，一般会有一个私钥，同时用私钥生成证书请求，再利用证书服务器的根证来签发证书。 SSL所使用的证书可以自己生成，也可以通过一个商业性CA（如Verisign 或 Thawte）签署证书。</li><li>签发证书的问题：如果使用的是商业证书，具体的签署方法请查看相关销售商的说明；如果是知己签发的证书，可以使用openssl自带的CA.sh 脚本工具。<a id="more"></a></li></ul><h4 id="认证级别"><a href="#认证级别" class="headerlink" title="认证级别"></a>认证级别</h4><p>证书有很多类型，分为三种认证级别：</p><ul><li>域名认证（Domain Validation）：最低级别认证，可以确认申请人拥有这个域名。对于这种证书，浏览器会在地址栏显示一把锁。</li><li>公司认证（Company Validation）：确认域名所有人是哪一家公司，证书里面会包含公司信息。</li><li>扩展认证（Extended Validation）：最高级别的认证，浏览器地址栏会显示公司名。</li></ul><p>域名认证： </p><p><img src="域名认证类型.jpg" alt="Alt text"></p><p>公司认证/扩展认证：</p><p><img src="公司扩展认证类型.jpg" alt="Alt text"></p><h4 id="覆盖范围"><a href="#覆盖范围" class="headerlink" title="覆盖范围"></a>覆盖范围</h4><ul><li>单域名证书：只能用于单一域名，google.com的证书不能用于www.google.com</li><li>通配符证书：可以用于某个域名及其所有一级子域名，比如*.google.com的证书可以用于google.com，也可以用于www.google.com</li><li>多域名证书：可以用于多个域名，比如google.com和github.com</li></ul><p>认证级别越高覆盖范围越广，价格越美丽。</p><p>还有一个免费证书的选择。由 ISRG（Internet Security Research Group，互联网安全研究小组）提供服务，而 ISRG 是来自于美国加利福尼亚州的一个公益组织。<a href="https://letsencrypt.org/" target="_blank" rel="noopener">Let’s Encrypt</a> 得到了 Mozilla、Cisco、Akamai、Electronic Frontier Foundation 和 Chrome 等众多公司和机构的支持，发展十分迅猛。</p><p>拿到证书以后，可以用 <a href="https://tools.keycdn.com/ssl" target="_blank" rel="noopener">SSL Certificate Check</a> 检查一下，信息是否正确。</p><h2 id="安装证书"><a href="#安装证书" class="headerlink" title="安装证书"></a>安装证书</h2><p>根据上面的介绍，证书会有多个文件，可以统一放到<code>你的web服务器路径/cert/</code>(linux OS，windows看你自己心情了)下面，然后根据你web服务器的不同在下面的链接中选择适合你的配置：</p><ul><li><a href="https://mozilla.github.io/server-side-tls/ssl-config-generator/" target="_blank" rel="noopener">https://mozilla.github.io/server-side-tls/ssl-config-generator/</a>  <em>Mozilla的证书配置文件模板</em></li><li><a href="https://github.com/SSLMate/tlsconfigguide/tree/master/templates" target="_blank" rel="noopener">https://github.com/SSLMate/tlsconfigguide/tree/master/templates</a>  <em>SSLMate的证书配置文件模板</em></li></ul><p>如果使用 Let’s Encrypt 证书，请使用自动安装工具 <a href="https://certbot.eff.org/" target="_blank" rel="noopener">Certbot</a><br>安装成功后，使用 <a href="https://www.ssllabs.com/ssltest/analyze.html" target="_blank" rel="noopener">SSL Labs Server Test</a> 检查一下证书是否生效。</p><h3 id="Nginx的写法"><a href="#Nginx的写法" class="headerlink" title="Nginx的写法"></a>Nginx的写法</h3><p>在Nginx的安装目录下创建cert目录，并且将下载的全部文件拷贝到cert目录中。如果申请证书时是自己创建的CSR文件，请将对应的私钥文件放到cert目录下并且命名为214750710900222.key</p><p>打开 Nginx 安装目录下 conf 目录中的 nginx.conf 文件，找到：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># HTTPS server</span><br><span class="line"># #server &#123;</span><br><span class="line"># listen 443;</span><br><span class="line"># server_name localhost;</span><br><span class="line"># ssl on;</span><br><span class="line"># ssl_certificate cert.pem;</span><br><span class="line"># ssl_certificate_key cert.key;</span><br><span class="line"># ssl_session_timeout 5m;</span><br><span class="line"># ssl_protocols SSLv2 SSLv3 TLSv1;</span><br><span class="line"># ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;</span><br><span class="line"># ssl_prefer_server_ciphers on;</span><br><span class="line"># location / &#123;</span><br><span class="line">#</span><br><span class="line">#</span><br><span class="line">#&#125;</span><br><span class="line">#&#125;</span><br></pre></td></tr></table></figure><p>将其修改为 (以下属性中ssl开头的属性与证书配置有直接关系，其它属性请结合自己的实际情况复制或调整) :</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 443;</span><br><span class="line">    server_name localhost;</span><br><span class="line">    ssl on;</span><br><span class="line">    root html;</span><br><span class="line">    index index.html index.htm;</span><br><span class="line">    ssl_certificate   cert/214750710900222.pem;</span><br><span class="line">    ssl_certificate_key  cert/214750710900222.key;</span><br><span class="line">    ssl_session_timeout 5m;</span><br><span class="line">    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class="line">    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">    ssl_prefer_server_ciphers on;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root html;</span><br><span class="line">        index index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>保存退出。</p><p>重启 Nginx。</p><blockquote><p>nginx -s reload</p></blockquote><p>通过 https 方式访问您的站点，测试站点证书的安装配置。</p><h3 id="Apache的写法"><a href="#Apache的写法" class="headerlink" title="Apache的写法"></a>Apache的写法</h3><p>在Apache的安装目录下创建cert目录，并且将下载的全部文件拷贝到cert目录中。如果申请证书时是自己创建的CSR文件，请将对应的私钥文件放到cert目录下并且命名为214750710900222.key；</p><p>打开 apache 安装目录下 conf 目录中的 httpd.conf 文件，找到以下内容并去掉“#”：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#LoadModule ssl_module modules/mod_ssl.so (如果找不到请确认是否编译过 openssl 插件)</span><br><span class="line">#Include conf/extra/httpd-ssl.conf</span><br></pre></td></tr></table></figure><p>打开 apache 安装目录下 conf/extra/httpd-ssl.conf 文件 (也可能是conf.d/ssl.conf，与操作系统及安装方式有关)， 在配置文件中查找以下配置语句(一定要写进<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">VirtualHost</span> *<span class="attr">:443</span>&gt;</span><span class="tag">&lt;/<span class="name">VirtualHost</span>&gt;</span></span><br></pre></td></tr></table></figure>标签里面):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#申请证书的域名</span><br><span class="line">ServerName xxxxxxx.com</span><br><span class="line">#网站文件的根目录  </span><br><span class="line">DocumentRoot &quot;C:\WWW\xxxxxx.com&quot; </span><br><span class="line"></span><br><span class="line">SSLEngine on </span><br><span class="line"># 添加 SSL 协议支持协议，去掉不安全的协议</span><br><span class="line">SSLProtocol all -SSLv2 -SSLv3</span><br><span class="line"># 修改加密套件如下</span><br><span class="line">SSLCipherSuite HIGH:!RC4:!MD5:!aNULL:!eNULL:!NULL:!DH:!EDH:!EXP:+MEDIUM</span><br><span class="line">SSLHonorCipherOrder on</span><br><span class="line"># 证书公钥配置</span><br><span class="line">SSLCertificateFile cert/public.pem</span><br><span class="line"># 证书私钥配置</span><br><span class="line">SSLCertificateKeyFile cert/214750710900222.key</span><br><span class="line"># 证书链配置，如果该属性开头有 &apos;#&apos;字符，请删除掉</span><br><span class="line">SSLCertificateChainFile cert/chain.pem</span><br></pre></td></tr></table></figure><p>重启 Apache。</p><p>通过 https 方式访问您的站点,测试站点证书的安装配置</p><p>参考<br>1.<a href="http://www.ruanyifeng.com/blog/2016/08/migrate-from-http-to-https.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2016/08/migrate-from-http-to-https.html</a><br>2.<a href="https://imququ.com/post/letsencrypt-certificate.html" target="_blank" rel="noopener">https://imququ.com/post/letsencrypt-certificate.html</a></p>]]></content>
      
      <categories>
          
          <category> 服务器 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HTTPS </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>HBase1.2安装配置</title>
      <link href="/2018/03/20/HBase1.2.6%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/"/>
      <content type="html"><![CDATA[<h2 id="安装模式"><a href="#安装模式" class="headerlink" title="安装模式"></a>安装模式</h2><p>Hbase分为三种安装模式：单机模式，伪分布式模式，完全分布式模式</p><ul><li>单机模式：单机模式的安装非常简单，几乎不用对安装文件做什么修改就可以使用。单机模式下，HBase并不使用HDFS，因此将安装文件解压后就几乎可以直接运行。</li><li>伪分布模式是一个运行在单台机器上的分布式模式。此模式下，HBase所有的守护进程将运行在同一个节点之上，而且需要依赖HDFS，因此在此之前必须保证HDFS已经成功运行。<a id="more"></a></li><li>完全分布式模式是运行在每台机器上，本文采取的就是这种方式。</li></ul><h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><p>1.选择合适版本<br>选择 Hadoop 版本对HBase部署很关键。下表显示不同HBase支持的Hadoop版本信息。基于HBase版本，应该选择合适的Hadoop版本。<br>可以从hbase官方文档查询支持版本，链接：<a href="http://hbase.apache.org/book.html#configuration" target="_blank" rel="noopener">http://hbase.apache.org/book.html#configuration</a>在浏览器中搜索 Hadoop version support即可</p><ul><li>“S” = supported</li><li>“X” = not supported</li><li>“NT” = Not tested</li></ul><table><thead><tr><th style="text-align:left"></th><th>HBase-1.2.x</th><th>HBase-1.3.x</th><th>HBase-2.0.x</th></tr></thead><tbody><tr><td style="text-align:left">Hadoop-2.4.x</td><td>S</td><td>S</td><td>X</td></tr><tr><td style="text-align:left">Hadoop-2.5.x</td><td>S</td><td>S</td><td>X</td></tr><tr><td style="text-align:left">Hadoop-2.6.0</td><td>X</td><td>X</td><td>X</td></tr><tr><td style="text-align:left">Hadoop-2.6.1+</td><td>S</td><td>S</td><td>S</td></tr><tr><td style="text-align:left">Hadoop-2.7.0</td><td>X</td><td>X</td><td>X</td></tr><tr><td style="text-align:left">Hadoop-2.7.1+</td><td>S</td><td>S</td><td>S</td></tr><tr><td style="text-align:left">Hadoop-2.8.0</td><td>X</td><td>X</td><td>X</td></tr><tr><td style="text-align:left">Hadoop-2.8.1</td><td>X</td><td>X</td><td>X</td></tr><tr><td style="text-align:left">Hadoop-3.0.0</td><td>NT</td><td>NT</td><td>NT</td></tr></tbody></table><p>HBase从官网下载即可，官方提供很多镜像地址，如<a href="http://mirror.jax.hugeserver.com/apache/hbase/" target="_blank" rel="noopener">http://mirror.jax.hugeserver.com/apache/hbase/</a></p><p>2.环境准备</p><p>注意：<em>需要提前对集群配置SSH免密登陆，时间同步，host主机名，java环境</em></p><p>集群机器</p><table><thead><tr><th style="text-align:left">IP</th><th>HostName</th><th>Master</th><th>RegionServer</th></tr></thead><tbody><tr><td style="text-align:left">192.168.100.111</td><td>mini1</td><td>yes</td><td>no</td></tr><tr><td style="text-align:left">192.168.100.112</td><td>mini2</td><td>no</td><td>yes</td></tr><tr><td style="text-align:left">192.168.100.113</td><td>mini3</td><td>no</td><td>yes</td></tr></tbody></table><p>软件环境</p><ul><li>系统：CentOS 7.2</li><li>Hadoop：2.6.4</li><li>ZooKeeper：3.4.10</li><li>jdk：1.7</li></ul><h2 id="下载和解压"><a href="#下载和解压" class="headerlink" title="下载和解压"></a>下载和解压</h2><p><strong><em>整体安装过程务必使用安装hadoop的用户来安装hbase</em></strong></p><blockquote><p>首先在一台机器上安装配置好，然后分发到集群中其他机器上</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; wget http://mirror.jax.hugeserver.com/apache/hbase/1.2.6/hbase-1.2.6-bin.tar.gz # 下载</span><br><span class="line">shell&gt; tar -xzvf hbase-1.2.6-bin.tar.gz -C /opt/  # 解压</span><br></pre></td></tr></table></figure><h2 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h2><p>修改环境变量需要root用户，在最下面增加HBASE的家目录HBASE_HOME<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; su - root</span><br><span class="line">shell&gt; echo &quot;HBASE_HOME=/opt/hbase-1.2.6&quot; &gt;&gt; /etc/profile</span><br><span class="line">shell&gt; echo &quot;PATH=$PATH:$HBASE_HOME/bin&quot; &gt;&gt; /etc/profile</span><br><span class="line">shell&gt; echo &quot;export HBASE_HOME PATH&quot; &gt;&gt; /etc/profile</span><br></pre></td></tr></table></figure></p><p>使环境变量生效<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; source /etc/profile</span><br></pre></td></tr></table></figure></p><p>修改资源限制<br>HBase 和其他的数据库软件一样会同时打开很多文件。Linux 中默认的ulimit 值是1024，这对HBase 来说太小了。当使用诸如bulkload 这种工具批量导入数据的时候会得到这样的异常信息：java.io.IOException:Too many open files。我们需要改变这个值，注意，这是对操作系统的参数调整，而不是通过HBase 配置文件完成的，我们可以大致估算ulimit 值需要配置为多大。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; ulimit -n 10240</span><br></pre></td></tr></table></figure></p><h2 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h2><p>hbase 相关的配置主要包括hbase-env.sh、hbase-site.xml、regionservers三个文件（如regionservers没有可以手动创建），都在 $HBASE_HOME/conf 下面</p><h3 id="配置hbase-env-sh"><a href="#配置hbase-env-sh" class="headerlink" title="配置hbase-env.sh"></a>配置hbase-env.sh</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; vim $HBASE_HOME/conf/hbase-env.sh</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">\# JDK安装目录  </span><br><span class="line">export JAVA_HOME=/opt/jdk1.7.0_80  </span><br><span class="line">export JAVA_CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar  </span><br><span class="line">\# hadoop配置文件的位置  </span><br><span class="line">export HBASE_CLASSPATH=/opt/hadoop-2.6.4/etc/hadoop  </span><br><span class="line">\# 如果使用独立安装的zookeeper这个地方就是false  </span><br><span class="line">export HBASE_MANAGES_ZK=false</span><br></pre></td></tr></table></figure><h3 id="配置hbase-site-xml"><a href="#配置hbase-site-xml" class="headerlink" title="配置hbase-site.xml"></a>配置hbase-site.xml</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;  </span><br><span class="line">        &lt;property&gt;  </span><br><span class="line">                &lt;name&gt;hbase.master.port&lt;/name&gt;  #hbase master的端口</span><br><span class="line">                &lt;value&gt;60000&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;hbase.master.info.port&lt;/name&gt;  #hbase web管理的端口</span><br><span class="line">                &lt;value&gt;60010&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;hbase.rootdir&lt;/name&gt;  #hbase共享目录，持久化hbase数据</span><br><span class="line">                &lt;value&gt;hdfs://mini1:9000/hbase&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;hbase.cluster.distributed&lt;/name&gt;  #是否分布式运行，false即为单机</span><br><span class="line">                &lt;value&gt;true&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;hbase.zookeeper.quorum&lt;/name&gt;  #zookeeper地址</span><br><span class="line">                &lt;value&gt;mini1:2181,mini2:2181,mini3:2181&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure><h3 id="配置regionservers"><a href="#配置regionservers" class="headerlink" title="配置regionservers"></a>配置regionservers</h3><p>regionservers这个文件内容是regionServer的域名，在1.2.6版本中没有，需要用户在$HBASE_HOME/conf下手动创建</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; touch $HBASE_HOME/conf/regionservers</span><br><span class="line">shell&gt; echo &quot;mini2&quot; &gt;&gt; $HBASE_HOME/conf/regionservers</span><br><span class="line">shell&gt; echo &quot;mini3&quot; &gt;&gt; $HBASE_HOME/conf/regionservers</span><br></pre></td></tr></table></figure><h3 id="hadoop的hdfs-site-xml和core-site-xml"><a href="#hadoop的hdfs-site-xml和core-site-xml" class="headerlink" title="hadoop的hdfs-site.xml和core-site.xml"></a>hadoop的hdfs-site.xml和core-site.xml</h3><p>将集群hadoop的这两个配置文件复制到hbase的conf目录下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; cp /opt/hadoop-2.6.4/etc/hadoop/hdfs-site.xml $HBASE_HOME/conf/</span><br><span class="line">shell&gt; cp /opt/hadoop-2.6.4/etc/hadoop/core-site.xml $HBASE_HOME/conf/</span><br></pre></td></tr></table></figure><h2 id="分发到其他机器"><a href="#分发到其他机器" class="headerlink" title="分发到其他机器"></a>分发到其他机器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; scp -r /opt/hbase-1.2.6 mini2:/opt</span><br><span class="line">shell&gt; scp -r /opt/hbase-1.2.6 mini3:/opt</span><br></pre></td></tr></table></figure><h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><p>HBase强依赖hadoop和zookeeper，所以务必先确保集群的hadoop和zk都正常启动</p><p>启动hadoop(mini1)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; /opt/hadoop-2.6.4/sbin/start-all.sh</span><br></pre></td></tr></table></figure><p>启动zookeeper（mini, mini2, mini3分别执行）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; /opt/zookeeper-3.4.10/bin/zkServer.sh start</span><br></pre></td></tr></table></figure><p>启动HBase（mini1）</p><blockquote><p>一般哪台启动hbase，哪台就是HMaster</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; start-hbase.sh</span><br></pre></td></tr></table></figure><h3 id="查看进程"><a href="#查看进程" class="headerlink" title="查看进程"></a>查看进程</h3><p>mini1(master)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; jps</span><br><span class="line"></span><br><span class="line">1254 DataNode  </span><br><span class="line">1550 ResourceManager  </span><br><span class="line">3296 Jps  </span><br><span class="line">1988 QuorumPeerMain  </span><br><span class="line">1387 SecondaryNameNode  </span><br><span class="line">1158 NameNode  </span><br><span class="line">2950 HMaster   # hbase master进程</span><br><span class="line">1679 NodeManager</span><br></pre></td></tr></table></figure><p>mini2,mini3(salve)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; jps</span><br><span class="line"></span><br><span class="line">1288 QuorumPeerMain  </span><br><span class="line">1148 NodeManager  </span><br><span class="line">1791 Jps  </span><br><span class="line">1571 HRegionServer  # hbase slave进程</span><br></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> 大数据 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HBase </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Centos7.4 安装MySQL 5.7.21 (通用二进制包)</title>
      <link href="/2018/02/01/Centos7-4-%E5%AE%89%E8%A3%85MySQL-5-7-21-%E9%80%9A%E7%94%A8%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85/"/>
      <content type="html"><![CDATA[<h2 id="下载安装包"><a href="#下载安装包" class="headerlink" title="下载安装包"></a>下载安装包</h2><p>MySQL 官方下载地址：<a href="https://dev.mysql.com/downloads/mysql/" target="_blank" rel="noopener">https://dev.mysql.com/downloads/mysql/</a><br>MySQL 5.7官方安装文档：<a href="https://dev.mysql.com/doc/refman/5.7/en/binary-installation.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/5.7/en/binary-installation.html</a></p><p>本文完全按照官方步骤配置安装<br><a id="more"></a><br>选择Linux - generic 64位安装包<br><img src="http://img.blog.csdn.net/20180117211028862?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvem1sMzcyMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""><br>MySQL 5.7.21 二进制包下载地址：<a href="https://dev.mysql.com//Downloads/MySQL-5.7/mysql-5.7.21-linux-glibc2.12-x86_64.tar.gz" target="_blank" rel="noopener">https://dev.mysql.com//Downloads/MySQL-5.7/mysql-5.7.21-linux-glibc2.12-x86_64.tar.gz</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget --no-check-certificate https://dev.mysql.com//Downloads/MySQL-5.7/mysql-5.7.21-linux-glibc2.12-x86_64.tar.gz</span><br></pre></td></tr></table></figure><h2 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h2><p>MySQL依赖于libaio 库。如果这个库没有在本地安装，数据目录初始化和后续的服务器启动步骤将会失败。请使用适当的软件包管理器进行安装。例如，在基于Yum的系统上：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; yum search libaio  </span><br><span class="line">shell&gt; yum install libaio</span><br></pre></td></tr></table></figure></p><p>注意<br>SLES 11：从MySQL 5.7.19开始，Linux通用tar包的格式是EL6而不是EL5。以致于MySQL客户端bin / mysql需要libtinfo.so.5。</p><p>解决方法是创建软链接，例如64位系统上的<code>ln -s libncurses.so.5.6 /lib64/libtinfo.so.5</code>或32 位系统上的<code>ln -s libncurses.so.5.6 /lib/libtinfo.so.5</code>。</p><h2 id="创建一个mysql用户和组"><a href="#创建一个mysql用户和组" class="headerlink" title="创建一个mysql用户和组"></a>创建一个mysql用户和组</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; groupadd mysql</span><br><span class="line">shell&gt; useradd -r -g mysql -s /bin/false mysql</span><br></pre></td></tr></table></figure><p>注意<br>此用户仅用于运行mysql服务，而不是登录，因此使用useradd -r和-s /bin/false命令选项来创建对服务器主机没有登录权限的用户。</p><h2 id="解压到指定目录"><a href="#解压到指定目录" class="headerlink" title="解压到指定目录"></a>解压到指定目录</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; tar -zxvf mysql-5.7.21-linux-glibc2.12-x86_64.tar.gz -C /opt</span><br><span class="line">shell&gt; cd /opt</span><br><span class="line">shell&gt; mv mysql-5.7.21-linux-glibc2.12-x86_64 mysql-5.7.21</span><br></pre></td></tr></table></figure><h2 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;export PATH=$PATH:/opt/mysql-5.7.21/bin&quot; &gt;&gt; /etc/profile</span><br></pre></td></tr></table></figure><h2 id="配置数据库目录"><a href="#配置数据库目录" class="headerlink" title="配置数据库目录"></a>配置数据库目录</h2><p>数据目录：<code>/opt/mysql-5.7.21/data</code><br>参数文件my.cnf：<code>/etc/my.cnf</code><br>错误日志log-error：<code>/opt/mysql-5.7.21/log/mysql_error.log</code><br>二进制日志log-bin：<code>/opt/mysql-5.7.21/log/mysql_bin.log</code><br>慢查询日志slow_query_log_file：<code>/opt/mysql-5.7.21/log/mysql_slow_query.log</code><br>套接字socket文件：<code>/opt/mysql-5.7.21/run/mysql.sock</code><br>pid文件：<code>/opt/mysql-5.7.21/run/mysql.pid</code><br>创建目录：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mkdir -p /opt/mysql-5.7.21/&#123;data,log,etc,run&#125;</span><br><span class="line">shell&gt; chown -R mysql:mysql /opt/mysql-5.7.21</span><br><span class="line">shell&gt; chmod 750 /opt/mysql-5.7.21/&#123;data,log,etc,run&#125;</span><br></pre></td></tr></table></figure><h2 id="配置my-cnf文件"><a href="#配置my-cnf文件" class="headerlink" title="配置my.cnf文件"></a>配置my.cnf文件</h2><p>在/etc/下创建my.cnf文件，加入如下参数，其他参数根据需要配置（以下配置按默认配置设置）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; touch /etc/my.cnf   </span><br><span class="line">shell&gt; chown mysql:mysql /etc/my.cnf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line">port = 3306</span><br><span class="line">socket = /opt/mysql-5.7.21/run/mysql.sock</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">port = 3306</span><br><span class="line">socket = /opt/mysql-5.7.21/run/mysql.sock</span><br><span class="line">pid_file = /opt/mysql-5.7.21/run/mysql.pid</span><br><span class="line">datadir = /opt/mysql-5.7.21/data</span><br><span class="line">default_storage_engine = InnoDB</span><br><span class="line">max_allowed_packet = 128M</span><br><span class="line">max_connections = 2048</span><br><span class="line">open_files_limit = 65535</span><br><span class="line"></span><br><span class="line">skip-name-resolve</span><br><span class="line">lower_case_table_names=1</span><br><span class="line"></span><br><span class="line">character-set-server = utf8mb4</span><br><span class="line">collation-server = utf8mb4_unicode_ci</span><br><span class="line">init_connect=&apos;SET NAMES utf8mb4&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">innodb_buffer_pool_size = 128M</span><br><span class="line">innodb_log_file_size = 128M</span><br><span class="line">innodb_file_per_table = 1</span><br><span class="line">innodb_flush_log_at_trx_commit = 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key_buffer_size = 16M</span><br><span class="line"></span><br><span class="line">log-error = /opt/mysql-5.7.21/log/mysql_error.log</span><br><span class="line">log-bin = /opt/mysql-5.7.21/log/mysql_bin.log</span><br><span class="line">slow_query_log = 1</span><br><span class="line">slow_query_log_file = /opt/mysql-5.7.21/log/mysql_slow_query.log</span><br><span class="line">long_query_time = 5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tmp_table_size = 16M</span><br><span class="line">max_heap_table_size = 16M</span><br><span class="line">query_cache_type = 0</span><br><span class="line">query_cache_size = 0</span><br><span class="line"></span><br><span class="line">server-id=1</span><br></pre></td></tr></table></figure><h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysqld --initialize --user=mysql --basedir=/opt/mysql-5.7.21 --datadir=/opt/mysql-5.7.21/data</span><br></pre></td></tr></table></figure><p>此时会生成一个临时密码，可以在mysql_error.log文件找到</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; grep &apos;temporary password&apos; /opt/mysql-5.7.21/log/mysql_error.log</span><br></pre></td></tr></table></figure><p>生成ssl</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysql_ssl_rsa_setup --basedir=/opt/mysql-5.7.21 --datadir=/opt/mysql-5.7.21/data/</span><br></pre></td></tr></table></figure><h2 id="配置服务，使用systemctl管理"><a href="#配置服务，使用systemctl管理" class="headerlink" title="配置服务，使用systemctl管理"></a>配置服务，使用systemctl管理</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; cd /usr/lib/systemd/system</span><br><span class="line">shell&gt; touch mysqld.service</span><br></pre></td></tr></table></figure><p>文件内容如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"># Copyright (c) 2015, 2016, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line">#</span><br><span class="line"># This program is free software; you can redistribute it and/or modify</span><br><span class="line"># it under the terms of the GNU General Public License as published by</span><br><span class="line"># the Free Software Foundation; version 2 of the License.</span><br><span class="line">#</span><br><span class="line"># This program is distributed in the hope that it will be useful,</span><br><span class="line"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span><br><span class="line"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span><br><span class="line"># GNU General Public License for more details.</span><br><span class="line">#</span><br><span class="line"># You should have received a copy of the GNU General Public License</span><br><span class="line"># along with this program; if not, write to the Free Software</span><br><span class="line"># Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA</span><br><span class="line">#</span><br><span class="line"># systemd service file for MySQL forking server</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=MySQL Server</span><br><span class="line">Documentation=man:mysqld(8)</span><br><span class="line">Documentation=http://dev.mysql.com/doc/refman/en/using-systemd.html</span><br><span class="line">After=network.target</span><br><span class="line">After=syslog.target</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=mysql</span><br><span class="line">Group=mysql</span><br><span class="line"></span><br><span class="line">Type=forking</span><br><span class="line"></span><br><span class="line">PIDFile=/opt/mysql-5.7.21/run/mysql.pid</span><br><span class="line"></span><br><span class="line"># Disable service start and stop timeout logic of systemd for mysqld service.</span><br><span class="line">TimeoutSec=0</span><br><span class="line"></span><br><span class="line"># Execute pre and post scripts as root</span><br><span class="line">PermissionsStartOnly=true</span><br><span class="line"></span><br><span class="line"># Needed to create system tables</span><br><span class="line">#ExecStartPre=/usr/bin/mysqld_pre_systemd</span><br><span class="line"></span><br><span class="line"># Start main service</span><br><span class="line">ExecStart=/opt/mysql-5.7.21/bin/mysqld --daemonize --pid-file=/opt/mysql-5.7.21/run/mysql.pid $MYSQLD_OPTS</span><br><span class="line"></span><br><span class="line"># Use this to switch malloc implementation</span><br><span class="line">EnvironmentFile=-/etc/sysconfig/mysql</span><br><span class="line"></span><br><span class="line"># Sets open_files_limit</span><br><span class="line">LimitNOFILE = 65535</span><br><span class="line"></span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">RestartPreventExitStatus=1</span><br><span class="line"></span><br><span class="line">PrivateTmp=false</span><br></pre></td></tr></table></figure><p>让systemctl加载配置服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; systemctl daemon-reload</span><br><span class="line">shell&gt; systemctl enable mysqld.service</span><br><span class="line">shell&gt; systemctl is-enabled mysqld</span><br></pre></td></tr></table></figure><h2 id="启动MySQL服务"><a href="#启动MySQL服务" class="headerlink" title="启动MySQL服务"></a>启动MySQL服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; systemctl start mysqld.service</span><br></pre></td></tr></table></figure><h2 id="MySQL用户初始化"><a href="#MySQL用户初始化" class="headerlink" title="MySQL用户初始化"></a>MySQL用户初始化</h2><p>重置密码(上一步已经重置过了 这次可以忽略)<br>删除匿名用户<br>关闭root用户的远程登录<br>删除测试数据库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; /opt/mysql-5.7.21/bin/mysql_secure_installation</span><br><span class="line"></span><br><span class="line">Securing the MySQL server deployment.</span><br><span class="line"></span><br><span class="line">Enter password for user root:  # 输入初始化mysql时产生的密码，查看/opt/mysql-5.7.21/log/mysql_error.log 文件</span><br><span class="line"></span><br><span class="line">The existing password for the user account root has expired. Please set a new password.</span><br><span class="line"></span><br><span class="line">New password: # 新密码</span><br><span class="line"></span><br><span class="line">Re-enter new password: # 重新输入新密码</span><br><span class="line"></span><br><span class="line">VALIDATE PASSWORD PLUGIN can be used to test passwords</span><br><span class="line">and improve security. It checks the strength of password</span><br><span class="line">and allows the users to set only those passwords which are</span><br><span class="line">secure enough. Would you like to setup VALIDATE PASSWORD plugin?</span><br><span class="line"></span><br><span class="line">Press y|Y for Yes, any other key for No: Y   # 是否启用密码安全验证插件</span><br><span class="line"></span><br><span class="line">There are three levels of password validation policy:</span><br><span class="line"></span><br><span class="line">LOW    Length &gt;= 8</span><br><span class="line">MEDIUM Length &gt;= 8, numeric, mixed case, and special characters</span><br><span class="line">STRONG Length &gt;= 8, numeric, mixed case, special characters and dictionary                  file</span><br><span class="line"></span><br><span class="line">Please enter 0 = LOW, 1 = MEDIUM and 2 = STRONG: 2</span><br><span class="line">Using existing password for root.</span><br><span class="line"></span><br><span class="line">Estimated strength of the password: 100 </span><br><span class="line">Change the password for root ? ((Press y|Y for Yes, any other key for No) : N # 是否修改root密码</span><br><span class="line"></span><br><span class="line"> ... skipping.</span><br><span class="line">By default, a MySQL installation has an anonymous user,</span><br><span class="line">allowing anyone to log into MySQL without having to have</span><br><span class="line">a user account created for them. This is intended only for</span><br><span class="line">testing, and to make the installation go a bit smoother.</span><br><span class="line">You should remove them before moving into a production</span><br><span class="line">environment.</span><br><span class="line"></span><br><span class="line">Remove anonymous users? (Press y|Y for Yes, any other key for No) : Y # 删除匿名用户</span><br><span class="line">Success.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Normally, root should only be allowed to connect from</span><br><span class="line">&apos;localhost&apos;. This ensures that someone cannot guess at</span><br><span class="line">the root password from the network.</span><br><span class="line"></span><br><span class="line">Disallow root login remotely? (Press y|Y for Yes, any other key for No) : Y # 关闭root用户的远程登录</span><br><span class="line">Success.</span><br><span class="line"></span><br><span class="line">By default, MySQL comes with a database named &apos;test&apos; that</span><br><span class="line">anyone can access. This is also intended only for testing,</span><br><span class="line">and should be removed before moving into a production</span><br><span class="line">environment.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Remove test database and access to it? (Press y|Y for Yes, any other key for No) : Y # 删除测试数据库</span><br><span class="line"> - Dropping test database...</span><br><span class="line">Success.</span><br><span class="line"></span><br><span class="line"> - Removing privileges on test database...</span><br><span class="line">Success.</span><br><span class="line"></span><br><span class="line">Reloading the privilege tables will ensure that all changes</span><br><span class="line">made so far will take effect immediately.</span><br><span class="line"></span><br><span class="line">Reload privilege tables now? (Press y|Y for Yes, any other key for No) : Y # 重新加载表</span><br><span class="line">Success.</span><br><span class="line"></span><br><span class="line">All done!</span><br></pre></td></tr></table></figure><h2 id="导入时区"><a href="#导入时区" class="headerlink" title="导入时区"></a>导入时区</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysql_tzinfo_to_sql /usr/share/zoneinfo | mysql -u root -p mysql</span><br></pre></td></tr></table></figure><h2 id="验证安装"><a href="#验证安装" class="headerlink" title="验证安装"></a>验证安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysqladmin version -u root -p</span><br></pre></td></tr></table></figure><p>参考<br>1.<a href="https://www.jianshu.com/p/0d628b2f7476" target="_blank" rel="noopener">https://www.jianshu.com/p/0d628b2f7476</a><br>2.<a href="https://dev.mysql.com/doc/refman/5.7/en/binary-installation.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/5.7/en/binary-installation.html</a></p>]]></content>
      
      <categories>
          
          <category> 服务器 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>nginx服务器安装启动及配置文件详解</title>
      <link href="/2018/01/30/Nginx%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%89%E8%A3%85%E5%90%AF%E5%8A%A8%E5%8F%8A%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3/"/>
      <content type="html"><![CDATA[<h2 id="选择稳定nginx版本"><a href="#选择稳定nginx版本" class="headerlink" title="选择稳定nginx版本"></a>选择稳定nginx版本</h2><p>centos的yum不提供nginx安装，通过配置官方yum源的方式获取到的也只是源码包。所以我们找到了Nginx官网看下官方提供的安装方式：Nginx源码包下载的官网地址（<a href="http://nginx.org/en/download.html）" target="_blank" rel="noopener">http://nginx.org/en/download.html）</a><br>从官网上提供三个类型的版本，分别是Mainline version、Stable version、Legacy versions<br><a id="more"></a></p><ul><li>Mainline version：Mainline 是 Nginx 目前主力在做的版本，可以说是开发版</li><li>Stable version：最新稳定版，生产环境上建议使用的版本</li><li>Legacy versions：遗留的老版本的稳定版<br>在这里我们选择Stable 版本的  <code>nginx-1.12.2.tar.gz</code><br>安装环境是CentOS 6.5 安装过程所<strong>执行的命令需要root权限</strong>，所以我们选择使用root用户安装。<h2 id="安装依赖包和必要的库"><a href="#安装依赖包和必要的库" class="headerlink" title="安装依赖包和必要的库"></a>安装依赖包和必要的库</h2><h3 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h3></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; yum -y install gcc gcc-c++ make libtool</span><br></pre></td></tr></table></figure><p>这些依赖包是编译所必需的，如果yum上没有的话可以去下载源码来安装</p><h3 id="安装必要的库"><a href="#安装必要的库" class="headerlink" title="安装必要的库"></a>安装必要的库</h3><p>这些库都是nginx中一些功能模块所依赖的，如without-http_gzip_module需要zlib库来构建和运行此模块，http_rewrite_module需要pcre库来构建和运行此模块，http_ssl_module需要OpenSSL库来构建和运行此模块</p><h4 id="安装pcre库（版本8-40）"><a href="#安装pcre库（版本8-40）" class="headerlink" title="安装pcre库（版本8.40）"></a>安装pcre库（版本8.40）</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; cd /opt/software</span><br><span class="line">shell&gt; wget http://ftp.pcre.org/pub/pcre/pcre-8.40.tar.gz</span><br><span class="line">shell&gt; tar -zxvf pcre-8.40.tar.gz</span><br><span class="line">shell&gt; cd pcre-8.40</span><br><span class="line">shell&gt; ./configure --enable-utf8 --enable-unicode-properties</span><br><span class="line">shell&gt; make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h4 id="安装zlib库（版本1-2-11）"><a href="#安装zlib库（版本1-2-11）" class="headerlink" title="安装zlib库（版本1.2.11）"></a>安装zlib库（版本1.2.11）</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; cd /opt/software</span><br><span class="line">shell&gt; wget http://www.zlib.net/zlib-1.2.11.tar.gz</span><br><span class="line">shell&gt; tar -zxvf zlib-1.2.11.tar.gz</span><br><span class="line">shell&gt; cd zlib-1.2.11</span><br><span class="line">shell&gt; ./configure</span><br><span class="line">shell&gt; make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h4 id="安装OpenSSL（版本1-0-2k）"><a href="#安装OpenSSL（版本1-0-2k）" class="headerlink" title="安装OpenSSL（版本1.0.2k）"></a>安装OpenSSL（版本1.0.2k）</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; cd /opt/software</span><br><span class="line">shell&gt; wget http://www.openssl.org/source/old/1.0.2/openssl-1.0.2k.tar.gz</span><br><span class="line">shell&gt; tar -zxvf openssl-1.0.2k.tar.gz</span><br><span class="line">shell&gt; cd openssl-1.0.2k</span><br><span class="line">shell&gt; ./config</span><br><span class="line">shell&gt; make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h2 id="编译安装Nginx"><a href="#编译安装Nginx" class="headerlink" title="编译安装Nginx"></a>编译安装Nginx</h2><h3 id="nginx编译选项详解"><a href="#nginx编译选项详解" class="headerlink" title="nginx编译选项详解"></a>nginx编译选项详解</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; cd /opt</span><br><span class="line">shell&gt; wget http://nginx.org/download/nginx-1.12.2.tar.gz</span><br><span class="line">shell&gt; tar -zxvf nginx-1.12.2.tar.gz</span><br><span class="line">shell&gt; cd nginx-1.12.2</span><br><span class="line">shell&gt; ./configure --help</span><br></pre></td></tr></table></figure><p>可以在编译时./configure –help列出大部分常用模块和编译选项，列出的编译选项中以–without开头的都默认安装，以PATH结尾的需要手动指定依赖库<strong>源码</strong>目录。</p><blockquote><p>./configure –help<br>–help                             print this message<br>–prefix=PATH                      set installation prefix<br>–sbin-path=PATH                   set nginx binary pathname<br>–with-select_module               enable select module<br>–without-select_module            disable select module<br>–with-poll_module                 enable poll module<br>……</p></blockquote><p>下面是编译选项的说明</p><ul><li><code>--prefix=PATH</code>： 指定nginx的<strong>安装目录</strong>。默认 /usr/local/nginx</li><li><code>--sbin-path=PATH</code>：设置nginx可执行文件的名称。默认情况下，文件指向 安装目录/sbin/nginx</li><li><code>--conf-path=PATH</code>：设置nginx.conf配置文件的名称。nginx允许使用不同的配置文件启动，通过在命令行参数中指定它 。默认情况下，文件指向 安装目录/conf/nginx.conf</li><li><code>--pid-path=PATH</code>：设置存储主进程ID文件nginx.pid的名称。默认情况下，文件指向 安装目录/logs/nginx.pid</li><li><code>--error-log-path=PATH</code>：设置错误，警告和诊断文件的名称。默认情况下，文件指向 安装目录/logs/error.log</li><li><code>--http-log-path=PATH</code>：设置HTTP服务器的请求日志文件的名称。默认情况下，文件指向 安装目录/logs/access.log</li><li><code>--lock-path=PATH</code>：安装文件锁定，防止安装文件被别人利用，或自己误操作。</li><li><code>--user=nginx</code>：指定程序运行时的非特权用户。安装完成后，可以随时在nginx.conf配置文件更改user。默认用户名为nobody</li><li><code>--group=nginx</code>：指定程序运行时的非特权用户所在组名称。默认情况下，组名称设置为非root用户的名称。</li><li><code>--with-http_realip_module</code> 启用<code>ngx_http_realip_module</code>支持（这个模块允许从请求标头更改客户端的IP地址值，默认为关）</li><li><code>--with-http_ssl_module</code> ：启用<code>ngx_http_ssl_module</code>支持（使支持https请求，需已安装openssl）</li><li><code>--with-http_stub_status_module</code> ：启用<code>ngx_http_stub_status_module</code>支持（获取nginx自上次启动以来的工作状态）</li><li><code>--with-http_gzip_static_module</code> ：启用<code>ngx_http_gzip_module</code>支持（该模块同–without-http_gzip_module功能一样）</li><li><code>--http-client-body-temp-path=PATH</code> ：设定http客户端请求临时文件路径</li><li><code>--http-proxy-temp-path=PATH</code>：设定http代理临时文件路径</li><li><code>--http-fastcgi-temp-path=PATH</code>：设定http fastcgi临时文件路径</li><li><code>--http-uwsgi-temp-path=PATH</code>：设定http scgi临时文件路径</li><li><code>--with-pcre</code>：设置pcre库的源码路径，如果已通过yum方式安装，使用–with-pcre自动找到库文件。使用<code>--with-pcre=PATH</code>时，需要从PCRE网站下载pcre库的源码（版本8.4）并解压，剩下的就交给Nginx的./configure和make来完成。perl正则表达式使用在location指令和 <code>ngx_http_rewrite_module</code>模块中。</li><li><code>--with-zlib=PATH</code>：指定 zlib（版本1.2.11）的源码解压目录。在默认就启用的网络传输压缩模块ngx_http_gzip_module时需要使用zlib</li><li><code>--with-http_ssl_module</code>：使用https协议模块。默认情况下，该模块没有被构建。前提是openssl已安装</li><li><code>--add-module=PATH</code> ： 添加第三方外部模块，如<code>nginx-sticky-module-ng</code>或缓存模块。每次添加新的模块都要重新编译（Tengine可以在新加入module时无需重新编译）</li></ul><p>完整编译指令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; ./configure \</span><br><span class="line">--prefix=/opt/nginx-1.12.2 \</span><br><span class="line">--sbin-path=/opt/nginx-1.12.2/sbin/nginx \</span><br><span class="line">--conf-path=/opt/nginx-1.12.2/conf/nginx.conf \</span><br><span class="line">--pid-path=/opt/nginx-1.12.2/logs/nginx.pid \</span><br><span class="line">--lock-path=/opt/nginx-1.12.2/logs/nginx.lock \</span><br><span class="line">--error-log-path=/opt/nginx-1.12.2/logs/error.log \</span><br><span class="line">--http-log-path=/opt/nginx-1.12.2/logs/access.log \</span><br><span class="line">--user=nginx \</span><br><span class="line">--group=nginx \</span><br><span class="line">--with-poll_module \</span><br><span class="line">--with-http_realip_module \</span><br><span class="line">--with-http_ssl_module \</span><br><span class="line">--with-http_stub_status_module \</span><br><span class="line">--with-http_gzip_static_module \</span><br><span class="line">--with-zlib=/opt/software/zlib-1.2.11 \</span><br><span class="line">--with-pcre=/opt/software/pcre-8.40 \</span><br><span class="line">--with-openssl=/opt/software/openssl-1.0.2k \</span><br><span class="line">--with-pcre-jit</span><br></pre></td></tr></table></figure><h3 id="nginx安装"><a href="#nginx安装" class="headerlink" title="nginx安装"></a>nginx安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h2 id="启动Nginx"><a href="#启动Nginx" class="headerlink" title="启动Nginx"></a>启动Nginx</h2><h3 id="检查配置文件是否正确"><a href="#检查配置文件是否正确" class="headerlink" title="检查配置文件是否正确"></a>检查配置文件是否正确</h3><p>注意，启动前和修改了配置文件nginx.conf后最好先检查一下修改过的配置文件是否正确，以免重启后Nginx出现错误影响服务器稳定运行。判断Nginx配置是否正确命令如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; /opt/nginx-1.12.2/sbin/nginx -t</span><br></pre></td></tr></table></figure></p><h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; groupadd nginx   #创建nginx用户组</span><br><span class="line">shell&gt; useradd -r -g nginx -s /bin/false nginx</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; /opt/nginx-1.12.2/sbin/nginx        # 默认配置文件 conf/nginx.conf， -c指定其他配置文件</span><br></pre></td></tr></table></figure><p>启动成功会在logs目录中出现nginx.pid文件，即nginx进程号<br>若未成功可以查看logs目录下的error.log文件查看报错日志</p><h3 id="平滑重启nginx"><a href="#平滑重启nginx" class="headerlink" title="平滑重启nginx"></a>平滑重启nginx</h3><p>如果更改了配置就要重启Nginx，要先关闭Nginx再打开？不是的，可以向Nginx 发送信号，平滑重启。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; /opt/nginx-1.12.2/sbin/nginx -s reload</span><br></pre></td></tr></table></figure></p><p>或</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; kill -HUP 进程号或进程号文件路径</span><br></pre></td></tr></table></figure><h3 id="停止Nginx"><a href="#停止Nginx" class="headerlink" title="停止Nginx"></a>停止Nginx</h3><p>停止操作是通过向nginx进程发送信号来进行的<br>步骤1：查询nginx主进程号</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; ps -ef | grep nginx</span><br></pre></td></tr></table></figure><p>步骤2：发送信号<br>1.正常关闭</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; kill -QUIT 主进程号</span><br></pre></td></tr></table></figure><p>2.快速停止Nginx：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; kill -TERM 主进程号</span><br></pre></td></tr></table></figure><p>3.强制停止Nginx：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; pkill -9 nginx</span><br></pre></td></tr></table></figure><h3 id="Nginx服务自启"><a href="#Nginx服务自启" class="headerlink" title="Nginx服务自启"></a>Nginx服务自启</h3><p>把nginx添加到系统服务中，使其可以使用service nginx start/stop/restart等。<br>创建一个名称为nginx的脚本，添加如下内容，更改里面的nginx路径和配置文件路径，给执行权限。</p><p>如果想添加脚本用service启动，必须要脚本里面包含这2行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># chkconfig: - 85 15</span><br><span class="line"># description: nginx is a World Wide Web server. It is used to serve</span><br></pre></td></tr></table></figure></p><p>以下是写好的脚本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line"># chkconfig: - 85 15</span><br><span class="line"># description: nginx is a World Wide Web server. It is used to serve</span><br><span class="line"># description: Nginx is an HTTP(S) server, HTTP(S) reverse \</span><br><span class="line">#               proxyand IMAP/POP3 proxy server</span><br><span class="line"># processname: nginx</span><br><span class="line"># config:      /etc/nginx/nginx.conf</span><br><span class="line"># config:      /etc/sysconfig/nginx</span><br><span class="line"># pidfile:     /var/run/nginx.pid</span><br><span class="line"># Source function library.</span><br><span class="line">. /etc/rc.d/init.d/functions</span><br><span class="line"># Source networking configuration.</span><br><span class="line">. /etc/sysconfig/network</span><br><span class="line"># Check that networking is up.</span><br><span class="line">[ &quot;$NETWORKING&quot; = &quot;no&quot; ] &amp;&amp; exit 0</span><br><span class="line">nginx=&quot;/usr/local/nginx-1.12.2/sbin/nginx&quot;</span><br><span class="line">prog=$(basename $nginx)</span><br><span class="line">NGINX_CONF_FILE=&quot;/usr/local/nginx-nginx-1.12.2/conf/nginx.conf&quot;</span><br><span class="line">[ -f /etc/sysconfig/nginx ] &amp;&amp; . /etc/sysconfig/nginx</span><br><span class="line">lockfile=/var/lock/subsys/nginx</span><br><span class="line">start() &#123;</span><br><span class="line">    [ -x $nginx ] || exit 5</span><br><span class="line">    [ -f $NGINX_CONF_FILE ] || exit 6</span><br><span class="line">    echo -n $&quot;Starting $prog: &quot;</span><br><span class="line">    daemon $nginx -c $NGINX_CONF_FILE</span><br><span class="line">    retval=$?</span><br><span class="line">    echo</span><br><span class="line">    [ $retval -eq 0 ] &amp;&amp; touch $lockfile</span><br><span class="line">    return $retval</span><br><span class="line">&#125;</span><br><span class="line">stop() &#123;</span><br><span class="line">    echo -n $&quot;Stopping $prog: &quot;</span><br><span class="line">    killproc $prog -QUIT</span><br><span class="line">    retval=$?</span><br><span class="line">    echo</span><br><span class="line">    [ $retval -eq 0 ] &amp;&amp; rm -f $lockfile</span><br><span class="line">    return $retval</span><br><span class="line">killall -9 nginx</span><br><span class="line">&#125;</span><br><span class="line">restart() &#123;</span><br><span class="line">    configtest || return $?</span><br><span class="line">    stop</span><br><span class="line">    sleep 1</span><br><span class="line">    start</span><br><span class="line">&#125;</span><br><span class="line">reload() &#123;</span><br><span class="line">    configtest || return $?</span><br><span class="line">    echo -n $&quot;Reloading $prog: &quot;</span><br><span class="line">    killproc $nginx -HUP</span><br><span class="line">RETVAL=$?</span><br><span class="line">    echo</span><br><span class="line">&#125;</span><br><span class="line">force_reload() &#123;</span><br><span class="line">    restart</span><br><span class="line">&#125;</span><br><span class="line">configtest() &#123;</span><br><span class="line">$nginx -t -c $NGINX_CONF_FILE</span><br><span class="line">&#125;</span><br><span class="line">rh_status() &#123;</span><br><span class="line">    status $prog</span><br><span class="line">&#125;</span><br><span class="line">rh_status_q() &#123;</span><br><span class="line">    rh_status &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">&#125;</span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">    start)</span><br><span class="line">        rh_status_q &amp;&amp; exit0</span><br><span class="line">    $1</span><br><span class="line">        ;;</span><br><span class="line">    stop)</span><br><span class="line">        rh_status_q || exit 0</span><br><span class="line">        $1</span><br><span class="line">        ;;</span><br><span class="line">    restart|configtest)</span><br><span class="line">        $1</span><br><span class="line">        ;;</span><br><span class="line">    reload)</span><br><span class="line">        rh_status_q || exit 7</span><br><span class="line">        $1</span><br><span class="line">        ;;</span><br><span class="line">    force-reload)</span><br><span class="line">        force_reload</span><br><span class="line">        ;;</span><br><span class="line">    status)</span><br><span class="line">        rh_status</span><br><span class="line">        ;;</span><br><span class="line">    condrestart|try-restart)</span><br><span class="line">        rh_status_q || exit 0</span><br><span class="line">            ;;</span><br><span class="line">    *)  </span><br><span class="line">      echo $&quot;Usage: $0 &#123;start|stop|status|restart|condrestart|try-restart|reload|force-reload|configtest&#125;&quot;</span><br><span class="line">        exit 2</span><br><span class="line">esac</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; cp nginx /etc/init.d/</span><br><span class="line">shell&gt; chmod 755 /etc/init.d/nginx</span><br><span class="line">shell&gt; chkconfig --add nginx</span><br><span class="line">shell&gt; chkconfig -level 35 nginx</span><br></pre></td></tr></table></figure><p>测试启动</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; service nginx start</span><br><span class="line">shell&gt; service nginx stop</span><br><span class="line">shell&gt; service nginx reload</span><br></pre></td></tr></table></figure><p>参考：</p><blockquote><p><a href="http://nginx.org/en/docs/configure.html" target="_blank" rel="noopener">http://nginx.org/en/docs/configure.html</a><br><a href="http://www.jianshu.com/p/d5114a2a2052" target="_blank" rel="noopener">http://www.jianshu.com/p/d5114a2a2052</a><br><a href="http://seanlook.com/2015/05/17/nginx-install-and-config/" target="_blank" rel="noopener">http://seanlook.com/2015/05/17/nginx-install-and-config/</a><br><a href="http://www.ttlsa.com/nginx/nginx-configure-descriptions/" target="_blank" rel="noopener">http://www.ttlsa.com/nginx/nginx-configure-descriptions/</a></p></blockquote>]]></content>
      
      <categories>
          
          <category> 服务器 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
  
  
</search>
