<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>HBase1.2安装配置</title>
      <link href="/2018/03/20/HBase1.2.6%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/"/>
      <content type="html"><![CDATA[<h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><h3 id="选择合适版本选择-Hadoop-版本对HBase部署很关键。下表显示不同HBase支持的Hadoop版本信息。基于HBase版本，应该选择合适的Hadoop版本。可以从hbase官方文档查询支持版本，链接：http-hbase-apache-org-book-html-configuration，在浏览器中搜索-Hadoop-version-support即可"><a href="#选择合适版本选择-Hadoop-版本对HBase部署很关键。下表显示不同HBase支持的Hadoop版本信息。基于HBase版本，应该选择合适的Hadoop版本。可以从hbase官方文档查询支持版本，链接：http-hbase-apache-org-book-html-configuration，在浏览器中搜索-Hadoop-version-support即可" class="headerlink" title="选择合适版本选择 Hadoop 版本对HBase部署很关键。下表显示不同HBase支持的Hadoop版本信息。基于HBase版本，应该选择合适的Hadoop版本。可以从hbase官方文档查询支持版本，链接：http://hbase.apache.org/book.html#configuration，在浏览器中搜索 Hadoop version support即可"></a>选择合适版本选择 Hadoop 版本对HBase部署很关键。下表显示不同HBase支持的Hadoop版本信息。基于HBase版本，应该选择合适的Hadoop版本。可以从hbase官方文档查询支持版本，链接：<a href="http://hbase.apache.org/book.html#configuration，在浏览器中搜索" target="_blank" rel="noopener">http://hbase.apache.org/book.html#configuration，在浏览器中搜索</a> Hadoop version support即可</h3><ul><li>“S” = supported</li><li>“X” = not supported</li><li>“NT” = Not tested<br>|  |HBase-1.2.x|HBase-1.3.x|HBase-2.0.x|<br>|:-|———–|———–|———–|<br>|Hadoop-2.0.x-alpha|X|X|X|<br>|Hadoop-2.1.0-beta|X|X|X|<br>|Hadoop-2.2.0|X|X|X|<br>|Hadoop-2.3.x|X|X|X|<br>|Hadoop-2.4.x|S|S|X|</li></ul><h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><p>集群机器<br>|IP|HostName|Master|RegionServer|<br>|:-|——–|——|————|<br>|192.168.100.111|mini1|yes|no|<br>|192.168.100.112|mini2|no|yes|<br>|192.168.100.113|mini3|no|yes|</p><p>软件环境</p><ul><li>系统：CentOS 7.2</li><li>Hadoop：2.6.4</li><li>ZooKeeper：3.4.10</li><li>jdk：1.7</li><li>HBase：1.2.6</li></ul><p>需要提前对集群配置SSH免密登陆，时间同步，host主机名，java环境</p>]]></content>
      
      <categories>
          
          <category> 大数据 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HBase </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Centos7.4 安装MySQL 5.7.21 (通用二进制包)</title>
      <link href="/2018/02/01/Centos7-4-%E5%AE%89%E8%A3%85MySQL-5-7-21-%E9%80%9A%E7%94%A8%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85/"/>
      <content type="html"><![CDATA[<h2 id="下载安装包"><a href="#下载安装包" class="headerlink" title="下载安装包"></a>下载安装包</h2><p>MySQL 官方下载地址：<a href="https://dev.mysql.com/downloads/mysql/" target="_blank" rel="noopener">https://dev.mysql.com/downloads/mysql/</a><br>MySQL 5.7官方安装文档：<a href="https://dev.mysql.com/doc/refman/5.7/en/binary-installation.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/5.7/en/binary-installation.html</a></p><p>本文完全按照官方步骤配置安装<br><a id="more"></a><br>选择Linux - generic 64位安装包<br><img src="http://img.blog.csdn.net/20180117211028862?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvem1sMzcyMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""><br>MySQL 5.7.21 二进制包下载地址：<a href="https://dev.mysql.com//Downloads/MySQL-5.7/mysql-5.7.21-linux-glibc2.12-x86_64.tar.gz" target="_blank" rel="noopener">https://dev.mysql.com//Downloads/MySQL-5.7/mysql-5.7.21-linux-glibc2.12-x86_64.tar.gz</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget --no-check-certificate https://dev.mysql.com//Downloads/MySQL-5.7/mysql-5.7.21-linux-glibc2.12-x86_64.tar.gz</span><br></pre></td></tr></table></figure><h2 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h2><p>MySQL依赖于libaio 库。如果这个库没有在本地安装，数据目录初始化和后续的服务器启动步骤将会失败。请使用适当的软件包管理器进行安装。例如，在基于Yum的系统上：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; yum search libaio  </span><br><span class="line">shell&gt; yum install libaio</span><br></pre></td></tr></table></figure></p><p>注意<br>SLES 11：从MySQL 5.7.19开始，Linux通用tar包的格式是EL6而不是EL5。以致于MySQL客户端bin / mysql需要libtinfo.so.5。</p><p>解决方法是创建软链接，例如64位系统上的<code>ln -s libncurses.so.5.6 /lib64/libtinfo.so.5</code>或32 位系统上的<code>ln -s libncurses.so.5.6 /lib/libtinfo.so.5</code>。</p><h2 id="创建一个mysql用户和组"><a href="#创建一个mysql用户和组" class="headerlink" title="创建一个mysql用户和组"></a>创建一个mysql用户和组</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; groupadd mysql</span><br><span class="line">shell&gt; useradd -r -g mysql -s /bin/false mysql</span><br></pre></td></tr></table></figure><p>注意<br>此用户仅用于运行mysql服务，而不是登录，因此使用useradd -r和-s /bin/false命令选项来创建对服务器主机没有登录权限的用户。</p><h2 id="解压到指定目录"><a href="#解压到指定目录" class="headerlink" title="解压到指定目录"></a>解压到指定目录</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; tar -zxvf mysql-5.7.21-linux-glibc2.12-x86_64.tar.gz -C /opt</span><br><span class="line">shell&gt; cd /opt</span><br><span class="line">shell&gt; mv mysql-5.7.21-linux-glibc2.12-x86_64 mysql-5.7.21</span><br></pre></td></tr></table></figure><h2 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;export PATH=$PATH:/opt/mysql-5.7.21/bin&quot; &gt;&gt; /etc/profile</span><br></pre></td></tr></table></figure><h2 id="配置数据库目录"><a href="#配置数据库目录" class="headerlink" title="配置数据库目录"></a>配置数据库目录</h2><p>数据目录：<code>/opt/mysql-5.7.21/data</code><br>参数文件my.cnf：<code>/etc/my.cnf</code><br>错误日志log-error：<code>/opt/mysql-5.7.21/log/mysql_error.log</code><br>二进制日志log-bin：<code>/opt/mysql-5.7.21/log/mysql_bin.log</code><br>慢查询日志slow_query_log_file：<code>/opt/mysql-5.7.21/log/mysql_slow_query.log</code><br>套接字socket文件：<code>/opt/mysql-5.7.21/run/mysql.sock</code><br>pid文件：<code>/opt/mysql-5.7.21/run/mysql.pid</code><br>创建目录：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mkdir -p /opt/mysql-5.7.21/&#123;data,log,etc,run&#125;</span><br><span class="line">shell&gt; chown -R mysql:mysql /opt/mysql-5.7.21</span><br><span class="line">shell&gt; chmod 750 /opt/mysql-5.7.21/&#123;data,log,etc,run&#125;</span><br></pre></td></tr></table></figure><h2 id="配置my-cnf文件"><a href="#配置my-cnf文件" class="headerlink" title="配置my.cnf文件"></a>配置my.cnf文件</h2><p>在/etc/下创建my.cnf文件，加入如下参数，其他参数根据需要配置（以下配置按默认配置设置）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; touch /etc/my.cnf</span><br><span class="line">shell&gt; chown mysql:mysql /etc/my.cnf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line">port = 3306</span><br><span class="line">socket = /opt/mysql-5.7.21/run/mysql.sock</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">port = 3306</span><br><span class="line">socket = /opt/mysql-5.7.21/run/mysql.sock</span><br><span class="line">pid_file = /opt/mysql-5.7.21/run/mysql.pid</span><br><span class="line">datadir = /opt/mysql-5.7.21/data</span><br><span class="line">default_storage_engine = InnoDB</span><br><span class="line">max_allowed_packet = 128M</span><br><span class="line">max_connections = 2048</span><br><span class="line">open_files_limit = 65535</span><br><span class="line"></span><br><span class="line">skip-name-resolve</span><br><span class="line">lower_case_table_names=1</span><br><span class="line"></span><br><span class="line">character-set-server = utf8mb4</span><br><span class="line">collation-server = utf8mb4_unicode_ci</span><br><span class="line">init_connect=&apos;SET NAMES utf8mb4&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">innodb_buffer_pool_size = 128M</span><br><span class="line">innodb_log_file_size = 128M</span><br><span class="line">innodb_file_per_table = 1</span><br><span class="line">innodb_flush_log_at_trx_commit = 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key_buffer_size = 16M</span><br><span class="line"></span><br><span class="line">log-error = /opt/mysql-5.7.21/log/mysql_error.log</span><br><span class="line">log-bin = /opt/mysql-5.7.21/log/mysql_bin.log</span><br><span class="line">slow_query_log = 1</span><br><span class="line">slow_query_log_file = /opt/mysql-5.7.21/log/mysql_slow_query.log</span><br><span class="line">long_query_time = 5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tmp_table_size = 16M</span><br><span class="line">max_heap_table_size = 16M</span><br><span class="line">query_cache_type = 0</span><br><span class="line">query_cache_size = 0</span><br><span class="line"></span><br><span class="line">server-id=1</span><br></pre></td></tr></table></figure><h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysqld --initialize --user=mysql --basedir=/opt/mysql-5.7.21 --datadir=/opt/mysql-5.7.21/data</span><br></pre></td></tr></table></figure><p>此时会生成一个临时密码，可以在mysql_error.log文件找到</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; grep &apos;temporary password&apos; /opt/mysql-5.7.21/log/mysql_error.log</span><br></pre></td></tr></table></figure><p>生成ssl</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysql_ssl_rsa_setup --basedir=/opt/mysql-5.7.21 --datadir=/opt/mysql-5.7.21/data/</span><br></pre></td></tr></table></figure><h2 id="配置服务，使用systemctl管理"><a href="#配置服务，使用systemctl管理" class="headerlink" title="配置服务，使用systemctl管理"></a>配置服务，使用systemctl管理</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; cd /usr/lib/systemd/system</span><br><span class="line">shell&gt; touch mysqld.service</span><br></pre></td></tr></table></figure><p>文件内容如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"># Copyright (c) 2015, 2016, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line">#</span><br><span class="line"># This program is free software; you can redistribute it and/or modify</span><br><span class="line"># it under the terms of the GNU General Public License as published by</span><br><span class="line"># the Free Software Foundation; version 2 of the License.</span><br><span class="line">#</span><br><span class="line"># This program is distributed in the hope that it will be useful,</span><br><span class="line"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span><br><span class="line"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span><br><span class="line"># GNU General Public License for more details.</span><br><span class="line">#</span><br><span class="line"># You should have received a copy of the GNU General Public License</span><br><span class="line"># along with this program; if not, write to the Free Software</span><br><span class="line"># Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA</span><br><span class="line">#</span><br><span class="line"># systemd service file for MySQL forking server</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=MySQL Server</span><br><span class="line">Documentation=man:mysqld(8)</span><br><span class="line">Documentation=http://dev.mysql.com/doc/refman/en/using-systemd.html</span><br><span class="line">After=network.target</span><br><span class="line">After=syslog.target</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=mysql</span><br><span class="line">Group=mysql</span><br><span class="line"></span><br><span class="line">Type=forking</span><br><span class="line"></span><br><span class="line">PIDFile=/opt/mysql-5.7.21/run/mysql.pid</span><br><span class="line"></span><br><span class="line"># Disable service start and stop timeout logic of systemd for mysqld service.</span><br><span class="line">TimeoutSec=0</span><br><span class="line"></span><br><span class="line"># Execute pre and post scripts as root</span><br><span class="line">PermissionsStartOnly=true</span><br><span class="line"></span><br><span class="line"># Needed to create system tables</span><br><span class="line">#ExecStartPre=/usr/bin/mysqld_pre_systemd</span><br><span class="line"></span><br><span class="line"># Start main service</span><br><span class="line">ExecStart=/opt/mysql-5.7.21/bin/mysqld --daemonize --pid-file=/opt/mysql-5.7.21/run/mysql.pid $MYSQLD_OPTS</span><br><span class="line"></span><br><span class="line"># Use this to switch malloc implementation</span><br><span class="line">EnvironmentFile=-/etc/sysconfig/mysql</span><br><span class="line"></span><br><span class="line"># Sets open_files_limit</span><br><span class="line">LimitNOFILE = 65535</span><br><span class="line"></span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">RestartPreventExitStatus=1</span><br><span class="line"></span><br><span class="line">PrivateTmp=false</span><br></pre></td></tr></table></figure><p>让systemctl加载配置服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; systemctl daemon-reload</span><br><span class="line">shell&gt; systemctl enable mysqld.service</span><br><span class="line">shell&gt; systemctl is-enabled mysqld</span><br></pre></td></tr></table></figure><h2 id="启动MySQL服务"><a href="#启动MySQL服务" class="headerlink" title="启动MySQL服务"></a>启动MySQL服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; systemctl start mysqld.service</span><br></pre></td></tr></table></figure><h2 id="MySQL用户初始化"><a href="#MySQL用户初始化" class="headerlink" title="MySQL用户初始化"></a>MySQL用户初始化</h2><p>重置密码(上一步已经重置过了 这次可以忽略)<br>删除匿名用户<br>关闭root用户的远程登录<br>删除测试数据库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; /opt/mysql-5.7.21/bin/mysql_secure_installation</span><br><span class="line"></span><br><span class="line">Securing the MySQL server deployment.</span><br><span class="line"></span><br><span class="line">Enter password for user root:  # 输入初始化mysql时产生的密码，查看/opt/mysql-5.7.21/log/mysql_error.log 文件</span><br><span class="line"></span><br><span class="line">The existing password for the user account root has expired. Please set a new password.</span><br><span class="line"></span><br><span class="line">New password: # 新密码</span><br><span class="line"></span><br><span class="line">Re-enter new password: # 重新输入新密码</span><br><span class="line"></span><br><span class="line">VALIDATE PASSWORD PLUGIN can be used to test passwords</span><br><span class="line">and improve security. It checks the strength of password</span><br><span class="line">and allows the users to set only those passwords which are</span><br><span class="line">secure enough. Would you like to setup VALIDATE PASSWORD plugin?</span><br><span class="line"></span><br><span class="line">Press y|Y for Yes, any other key for No: Y   # 是否启用密码安全验证插件</span><br><span class="line"></span><br><span class="line">There are three levels of password validation policy:</span><br><span class="line"></span><br><span class="line">LOW    Length &gt;= 8</span><br><span class="line">MEDIUM Length &gt;= 8, numeric, mixed case, and special characters</span><br><span class="line">STRONG Length &gt;= 8, numeric, mixed case, special characters and dictionary                  file</span><br><span class="line"></span><br><span class="line">Please enter 0 = LOW, 1 = MEDIUM and 2 = STRONG: 2</span><br><span class="line">Using existing password for root.</span><br><span class="line"></span><br><span class="line">Estimated strength of the password: 100 </span><br><span class="line">Change the password for root ? ((Press y|Y for Yes, any other key for No) : N # 是否修改root密码</span><br><span class="line"></span><br><span class="line"> ... skipping.</span><br><span class="line">By default, a MySQL installation has an anonymous user,</span><br><span class="line">allowing anyone to log into MySQL without having to have</span><br><span class="line">a user account created for them. This is intended only for</span><br><span class="line">testing, and to make the installation go a bit smoother.</span><br><span class="line">You should remove them before moving into a production</span><br><span class="line">environment.</span><br><span class="line"></span><br><span class="line">Remove anonymous users? (Press y|Y for Yes, any other key for No) : Y # 删除匿名用户</span><br><span class="line">Success.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Normally, root should only be allowed to connect from</span><br><span class="line">&apos;localhost&apos;. This ensures that someone cannot guess at</span><br><span class="line">the root password from the network.</span><br><span class="line"></span><br><span class="line">Disallow root login remotely? (Press y|Y for Yes, any other key for No) : Y # 关闭root用户的远程登录</span><br><span class="line">Success.</span><br><span class="line"></span><br><span class="line">By default, MySQL comes with a database named &apos;test&apos; that</span><br><span class="line">anyone can access. This is also intended only for testing,</span><br><span class="line">and should be removed before moving into a production</span><br><span class="line">environment.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Remove test database and access to it? (Press y|Y for Yes, any other key for No) : Y # 删除测试数据库</span><br><span class="line"> - Dropping test database...</span><br><span class="line">Success.</span><br><span class="line"></span><br><span class="line"> - Removing privileges on test database...</span><br><span class="line">Success.</span><br><span class="line"></span><br><span class="line">Reloading the privilege tables will ensure that all changes</span><br><span class="line">made so far will take effect immediately.</span><br><span class="line"></span><br><span class="line">Reload privilege tables now? (Press y|Y for Yes, any other key for No) : Y # 重新加载表</span><br><span class="line">Success.</span><br><span class="line"></span><br><span class="line">All done!</span><br></pre></td></tr></table></figure><h2 id="导入时区"><a href="#导入时区" class="headerlink" title="导入时区"></a>导入时区</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysql_tzinfo_to_sql /usr/share/zoneinfo | mysql -u root -p mysql</span><br></pre></td></tr></table></figure><h2 id="验证安装"><a href="#验证安装" class="headerlink" title="验证安装"></a>验证安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysqladmin version -u root -p</span><br></pre></td></tr></table></figure><p>参考<br>1.<a href="https://www.jianshu.com/p/0d628b2f7476" target="_blank" rel="noopener">https://www.jianshu.com/p/0d628b2f7476</a><br>2.<a href="https://dev.mysql.com/doc/refman/5.7/en/binary-installation.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/5.7/en/binary-installation.html</a></p>]]></content>
      
      <categories>
          
          <category> 服务器运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>nginx服务器安装启动及配置文件详解</title>
      <link href="/2018/01/30/Nginx%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%89%E8%A3%85%E5%90%AF%E5%8A%A8%E5%8F%8A%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3/"/>
      <content type="html"><![CDATA[<h2 id="选择稳定nginx版本"><a href="#选择稳定nginx版本" class="headerlink" title="选择稳定nginx版本"></a>选择稳定nginx版本</h2><p>centos的yum不提供nginx安装，通过配置官方yum源的方式获取到的也只是源码包。所以我们找到了Nginx官网看下官方提供的安装方式：Nginx源码包下载的官网地址（<a href="http://nginx.org/en/download.html）" target="_blank" rel="noopener">http://nginx.org/en/download.html）</a><br>从官网上提供三个类型的版本，分别是Mainline version、Stable version、Legacy versions<br><a id="more"></a></p><ul><li>Mainline version：Mainline 是 Nginx 目前主力在做的版本，可以说是开发版</li><li>Stable version：最新稳定版，生产环境上建议使用的版本</li><li>Legacy versions：遗留的老版本的稳定版<br>在这里我们选择Stable 版本的  <code>nginx-1.12.2.tar.gz</code><br>安装环境是CentOS 6.5 安装过程所<strong>执行的命令需要root权限</strong>，所以我们选择使用root用户安装。<h2 id="安装依赖包和必要的库"><a href="#安装依赖包和必要的库" class="headerlink" title="安装依赖包和必要的库"></a>安装依赖包和必要的库</h2><h3 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h3></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; yum -y install gcc gcc-c++ make libtool</span><br></pre></td></tr></table></figure><p>这些依赖包是编译所必需的，如果yum上没有的话可以去下载源码来安装</p><h3 id="安装必要的库"><a href="#安装必要的库" class="headerlink" title="安装必要的库"></a>安装必要的库</h3><p>这些库都是nginx中一些功能模块所依赖的，如without-http_gzip_module需要zlib库来构建和运行此模块，http_rewrite_module需要pcre库来构建和运行此模块，http_ssl_module需要OpenSSL库来构建和运行此模块</p><h4 id="安装pcre库（版本8-40）"><a href="#安装pcre库（版本8-40）" class="headerlink" title="安装pcre库（版本8.40）"></a>安装pcre库（版本8.40）</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; cd /opt/software</span><br><span class="line">shell&gt; wget http://ftp.pcre.org/pub/pcre/pcre-8.40.tar.gz</span><br><span class="line">shell&gt; tar -zxvf pcre-8.40.tar.gz</span><br><span class="line">shell&gt; cd pcre-8.40</span><br><span class="line">shell&gt; ./configure --enable-utf8 --enable-unicode-properties</span><br><span class="line">shell&gt; make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h4 id="安装zlib库（版本1-2-11）"><a href="#安装zlib库（版本1-2-11）" class="headerlink" title="安装zlib库（版本1.2.11）"></a>安装zlib库（版本1.2.11）</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; cd /opt/software</span><br><span class="line">shell&gt; wget http://www.zlib.net/zlib-1.2.11.tar.gz</span><br><span class="line">shell&gt; tar -zxvf zlib-1.2.11.tar.gz</span><br><span class="line">shell&gt; cd zlib-1.2.11</span><br><span class="line">shell&gt; ./configure</span><br><span class="line">shell&gt; make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h4 id="安装OpenSSL（版本1-0-2k）"><a href="#安装OpenSSL（版本1-0-2k）" class="headerlink" title="安装OpenSSL（版本1.0.2k）"></a>安装OpenSSL（版本1.0.2k）</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; cd /opt/software</span><br><span class="line">shell&gt; wget http://www.openssl.org/source/old/1.0.2/openssl-1.0.2k.tar.gz</span><br><span class="line">shell&gt; tar -zxvf openssl-1.0.2k.tar.gz</span><br><span class="line">shell&gt; cd openssl-1.0.2k</span><br><span class="line">shell&gt; ./config</span><br><span class="line">shell&gt; make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h2 id="编译安装Nginx"><a href="#编译安装Nginx" class="headerlink" title="编译安装Nginx"></a>编译安装Nginx</h2><h3 id="nginx编译选项详解"><a href="#nginx编译选项详解" class="headerlink" title="nginx编译选项详解"></a>nginx编译选项详解</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; cd /opt</span><br><span class="line">shell&gt; wget http://nginx.org/download/nginx-1.12.2.tar.gz</span><br><span class="line">shell&gt; tar -zxvf nginx-1.12.2.tar.gz</span><br><span class="line">shell&gt; cd nginx-1.12.2</span><br><span class="line">shell&gt; ./configure --help</span><br></pre></td></tr></table></figure><p>可以在编译时./configure –help列出大部分常用模块和编译选项，列出的编译选项中以–without开头的都默认安装，以PATH结尾的需要手动指定依赖库<strong>源码</strong>目录。</p><blockquote><p>./configure –help<br>–help                             print this message<br>–prefix=PATH                      set installation prefix<br>–sbin-path=PATH                   set nginx binary pathname<br>–with-select_module               enable select module<br>–without-select_module            disable select module<br>–with-poll_module                 enable poll module<br>……</p></blockquote><p>下面是编译选项的说明</p><ul><li><code>--prefix=PATH</code>： 指定nginx的<strong>安装目录</strong>。默认 /usr/local/nginx</li><li><code>--sbin-path=PATH</code>：设置nginx可执行文件的名称。默认情况下，文件指向 安装目录/sbin/nginx</li><li><code>--conf-path=PATH</code>：设置nginx.conf配置文件的名称。nginx允许使用不同的配置文件启动，通过在命令行参数中指定它 。默认情况下，文件指向 安装目录/conf/nginx.conf</li><li><code>--pid-path=PATH</code>：设置存储主进程ID文件nginx.pid的名称。默认情况下，文件指向 安装目录/logs/nginx.pid</li><li><code>--error-log-path=PATH</code>：设置错误，警告和诊断文件的名称。默认情况下，文件指向 安装目录/logs/error.log</li><li><code>--http-log-path=PATH</code>：设置HTTP服务器的请求日志文件的名称。默认情况下，文件指向 安装目录/logs/access.log</li><li><code>--lock-path=PATH</code>：安装文件锁定，防止安装文件被别人利用，或自己误操作。</li><li><code>--user=nginx</code>：指定程序运行时的非特权用户。安装完成后，可以随时在nginx.conf配置文件更改user。默认用户名为nobody</li><li><code>--group=nginx</code>：指定程序运行时的非特权用户所在组名称。默认情况下，组名称设置为非root用户的名称。</li><li><code>--with-http_realip_module</code> 启用<code>ngx_http_realip_module</code>支持（这个模块允许从请求标头更改客户端的IP地址值，默认为关）</li><li><code>--with-http_ssl_module</code> ：启用<code>ngx_http_ssl_module</code>支持（使支持https请求，需已安装openssl）</li><li><code>--with-http_stub_status_module</code> ：启用<code>ngx_http_stub_status_module</code>支持（获取nginx自上次启动以来的工作状态）</li><li><code>--with-http_gzip_static_module</code> ：启用<code>ngx_http_gzip_module</code>支持（该模块同–without-http_gzip_module功能一样）</li><li><code>--http-client-body-temp-path=PATH</code> ：设定http客户端请求临时文件路径</li><li><code>--http-proxy-temp-path=PATH</code>：设定http代理临时文件路径</li><li><code>--http-fastcgi-temp-path=PATH</code>：设定http fastcgi临时文件路径</li><li><code>--http-uwsgi-temp-path=PATH</code>：设定http scgi临时文件路径</li><li><code>--with-pcre</code>：设置pcre库的源码路径，如果已通过yum方式安装，使用–with-pcre自动找到库文件。使用<code>--with-pcre=PATH</code>时，需要从PCRE网站下载pcre库的源码（版本8.4）并解压，剩下的就交给Nginx的./configure和make来完成。perl正则表达式使用在location指令和 <code>ngx_http_rewrite_module</code>模块中。</li><li><code>--with-zlib=PATH</code>：指定 zlib（版本1.2.11）的源码解压目录。在默认就启用的网络传输压缩模块ngx_http_gzip_module时需要使用zlib</li><li><code>--with-http_ssl_module</code>：使用https协议模块。默认情况下，该模块没有被构建。前提是openssl已安装</li><li><code>--add-module=PATH</code> ： 添加第三方外部模块，如<code>nginx-sticky-module-ng</code>或缓存模块。每次添加新的模块都要重新编译（Tengine可以在新加入module时无需重新编译）</li></ul><p>完整编译指令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; ./configure \</span><br><span class="line">--prefix=/opt/nginx-1.12.2 \</span><br><span class="line">--sbin-path=/opt/nginx-1.12.2/sbin/nginx \</span><br><span class="line">--conf-path=/opt/nginx-1.12.2/conf/nginx.conf \</span><br><span class="line">--pid-path=/opt/nginx-1.12.2/logs/nginx.pid \</span><br><span class="line">--lock-path=/opt/nginx-1.12.2/logs/nginx.lock \</span><br><span class="line">--error-log-path=/opt/nginx-1.12.2/logs/error.log \</span><br><span class="line">--http-log-path=/opt/nginx-1.12.2/logs/access.log \</span><br><span class="line">--user=nginx \</span><br><span class="line">--group=nginx \</span><br><span class="line">--with-poll_module \</span><br><span class="line">--with-http_realip_module \</span><br><span class="line">--with-http_ssl_module \</span><br><span class="line">--with-http_stub_status_module \</span><br><span class="line">--with-http_gzip_static_module \</span><br><span class="line">--with-zlib=/opt/software/zlib-1.2.11 \</span><br><span class="line">--with-pcre=/opt/software/pcre-8.40 \</span><br><span class="line">--with-openssl=/opt/software/openssl-1.0.2k \</span><br><span class="line">--with-pcre-jit</span><br></pre></td></tr></table></figure><h3 id="nginx安装"><a href="#nginx安装" class="headerlink" title="nginx安装"></a>nginx安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h2 id="启动Nginx"><a href="#启动Nginx" class="headerlink" title="启动Nginx"></a>启动Nginx</h2><h3 id="检查配置文件是否正确"><a href="#检查配置文件是否正确" class="headerlink" title="检查配置文件是否正确"></a>检查配置文件是否正确</h3><p>注意，启动前和修改了配置文件nginx.conf后最好先检查一下修改过的配置文件是否正确，以免重启后Nginx出现错误影响服务器稳定运行。判断Nginx配置是否正确命令如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; /opt/nginx-1.12.2/sbin/nginx -t</span><br></pre></td></tr></table></figure></p><h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; groupadd nginx   #创建nginx用户组</span><br><span class="line">shell&gt; useradd -r -g nginx -s /bin/false nginx</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; /opt/nginx-1.12.2/sbin/nginx        # 默认配置文件 conf/nginx.conf， -c指定其他配置文件</span><br></pre></td></tr></table></figure><p>启动成功会在logs目录中出现nginx.pid文件，即nginx进程号<br>若未成功可以查看logs目录下的error.log文件查看报错日志</p><h3 id="平滑重启nginx"><a href="#平滑重启nginx" class="headerlink" title="平滑重启nginx"></a>平滑重启nginx</h3><p>如果更改了配置就要重启Nginx，要先关闭Nginx再打开？不是的，可以向Nginx 发送信号，平滑重启。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; /opt/nginx-1.12.2/sbin/nginx -s reload</span><br></pre></td></tr></table></figure></p><p>或</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; kill -HUP 进程号或进程号文件路径</span><br></pre></td></tr></table></figure><h3 id="停止Nginx"><a href="#停止Nginx" class="headerlink" title="停止Nginx"></a>停止Nginx</h3><p>停止操作是通过向nginx进程发送信号来进行的<br>步骤1：查询nginx主进程号</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; ps -ef | grep nginx</span><br></pre></td></tr></table></figure><p>步骤2：发送信号<br>1.正常关闭</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; kill -QUIT 主进程号</span><br></pre></td></tr></table></figure><p>2.快速停止Nginx：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; kill -TERM 主进程号</span><br></pre></td></tr></table></figure><p>3.强制停止Nginx：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; pkill -9 nginx</span><br></pre></td></tr></table></figure><h3 id="Nginx服务自启"><a href="#Nginx服务自启" class="headerlink" title="Nginx服务自启"></a>Nginx服务自启</h3><p>把nginx添加到系统服务中，使其可以使用service nginx start/stop/restart等。<br>创建一个名称为nginx的脚本，添加如下内容，更改里面的nginx路径和配置文件路径，给执行权限。</p><p>如果想添加脚本用service启动，必须要脚本里面包含这2行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># chkconfig: - 85 15</span><br><span class="line"># description: nginx is a World Wide Web server. It is used to serve</span><br></pre></td></tr></table></figure><p>以下是写好的脚本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line"># chkconfig: - 85 15</span><br><span class="line"># description: nginx is a World Wide Web server. It is used to serve</span><br><span class="line"># description: Nginx is an HTTP(S) server, HTTP(S) reverse \</span><br><span class="line">#               proxyand IMAP/POP3 proxy server</span><br><span class="line"># processname: nginx</span><br><span class="line"># config:      /etc/nginx/nginx.conf</span><br><span class="line"># config:      /etc/sysconfig/nginx</span><br><span class="line"># pidfile:     /var/run/nginx.pid</span><br><span class="line"># Source function library.</span><br><span class="line">. /etc/rc.d/init.d/functions</span><br><span class="line"># Source networking configuration.</span><br><span class="line">. /etc/sysconfig/network</span><br><span class="line"># Check that networking is up.</span><br><span class="line">[ &quot;$NETWORKING&quot; = &quot;no&quot; ] &amp;&amp; exit 0</span><br><span class="line">nginx=&quot;/usr/local/nginx-1.12.2/sbin/nginx&quot;</span><br><span class="line">prog=$(basename $nginx)</span><br><span class="line">NGINX_CONF_FILE=&quot;/usr/local/nginx-nginx-1.12.2/conf/nginx.conf&quot;</span><br><span class="line">[ -f /etc/sysconfig/nginx ] &amp;&amp; . /etc/sysconfig/nginx</span><br><span class="line">lockfile=/var/lock/subsys/nginx</span><br><span class="line">start() &#123;</span><br><span class="line">    [ -x $nginx ] || exit 5</span><br><span class="line">    [ -f $NGINX_CONF_FILE ] || exit 6</span><br><span class="line">    echo -n $&quot;Starting $prog: &quot;</span><br><span class="line">    daemon $nginx -c $NGINX_CONF_FILE</span><br><span class="line">    retval=$?</span><br><span class="line">    echo</span><br><span class="line">    [ $retval -eq 0 ] &amp;&amp; touch $lockfile</span><br><span class="line">    return $retval</span><br><span class="line">&#125;</span><br><span class="line">stop() &#123;</span><br><span class="line">    echo -n $&quot;Stopping $prog: &quot;</span><br><span class="line">    killproc $prog -QUIT</span><br><span class="line">    retval=$?</span><br><span class="line">    echo</span><br><span class="line">    [ $retval -eq 0 ] &amp;&amp; rm -f $lockfile</span><br><span class="line">    return $retval</span><br><span class="line">killall -9 nginx</span><br><span class="line">&#125;</span><br><span class="line">restart() &#123;</span><br><span class="line">    configtest || return $?</span><br><span class="line">    stop</span><br><span class="line">    sleep 1</span><br><span class="line">    start</span><br><span class="line">&#125;</span><br><span class="line">reload() &#123;</span><br><span class="line">    configtest || return $?</span><br><span class="line">    echo -n $&quot;Reloading $prog: &quot;</span><br><span class="line">    killproc $nginx -HUP</span><br><span class="line">RETVAL=$?</span><br><span class="line">    echo</span><br><span class="line">&#125;</span><br><span class="line">force_reload() &#123;</span><br><span class="line">    restart</span><br><span class="line">&#125;</span><br><span class="line">configtest() &#123;</span><br><span class="line">$nginx -t -c $NGINX_CONF_FILE</span><br><span class="line">&#125;</span><br><span class="line">rh_status() &#123;</span><br><span class="line">    status $prog</span><br><span class="line">&#125;</span><br><span class="line">rh_status_q() &#123;</span><br><span class="line">    rh_status &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">&#125;</span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">    start)</span><br><span class="line">        rh_status_q &amp;&amp; exit0</span><br><span class="line">    $1</span><br><span class="line">        ;;</span><br><span class="line">    stop)</span><br><span class="line">        rh_status_q || exit 0</span><br><span class="line">        $1</span><br><span class="line">        ;;</span><br><span class="line">    restart|configtest)</span><br><span class="line">        $1</span><br><span class="line">        ;;</span><br><span class="line">    reload)</span><br><span class="line">        rh_status_q || exit 7</span><br><span class="line">        $1</span><br><span class="line">        ;;</span><br><span class="line">    force-reload)</span><br><span class="line">        force_reload</span><br><span class="line">        ;;</span><br><span class="line">    status)</span><br><span class="line">        rh_status</span><br><span class="line">        ;;</span><br><span class="line">    condrestart|try-restart)</span><br><span class="line">        rh_status_q || exit 0</span><br><span class="line">            ;;</span><br><span class="line">    *)  </span><br><span class="line">      echo $&quot;Usage: $0 &#123;start|stop|status|restart|condrestart|try-restart|reload|force-reload|configtest&#125;&quot;</span><br><span class="line">        exit 2</span><br><span class="line">esac</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; cp nginx /etc/init.d/</span><br><span class="line">shell&gt; chmod 755 /etc/init.d/nginx</span><br><span class="line">shell&gt; chkconfig --add nginx</span><br><span class="line">shell&gt; chkconfig -level 35 nginx</span><br></pre></td></tr></table></figure><p>测试启动</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; service nginx start</span><br><span class="line">shell&gt; service nginx stop</span><br><span class="line">shell&gt; service nginx reload</span><br></pre></td></tr></table></figure><p>参考：</p><blockquote><p><a href="http://nginx.org/en/docs/configure.html" target="_blank" rel="noopener">http://nginx.org/en/docs/configure.html</a><br><a href="http://www.jianshu.com/p/d5114a2a2052" target="_blank" rel="noopener">http://www.jianshu.com/p/d5114a2a2052</a><br><a href="http://seanlook.com/2015/05/17/nginx-install-and-config/" target="_blank" rel="noopener">http://seanlook.com/2015/05/17/nginx-install-and-config/</a><br><a href="http://www.ttlsa.com/nginx/nginx-configure-descriptions/" target="_blank" rel="noopener">http://www.ttlsa.com/nginx/nginx-configure-descriptions/</a></p></blockquote>]]></content>
      
      <categories>
          
          <category> 服务器运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
  
  
</search>
